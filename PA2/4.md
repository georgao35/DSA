# Kidd

## 设计思路

实现一个线段树。由于题目中的范围过大，因此考虑将相邻的不被访问的点融合到一起，这样就相当于最多有$4m$个结点的线段树，可以在空间限制内实现。

### 数据结构和算法

```c++
struct node{
    ll tag, sum; int left, right;
}
```

`left`和`right`是结点所代表的区间范围的左、右端点；`tag`是懒惰标记，代表加在这个区间上的反转次数；`sum`是区间内所有点的反转次数的总和。

`flip()`、`query()`函数通过递归的方法查询区间内反转的次数，并且在查询时通过`push_down()`、`push_up()`更新懒惰标记和区间内的和。

## 问题

1. 线段树可能达到的最大空间是所有叶子结点个数的四倍多，因此在最初的时候数组大小较小，按比例增大后正常通过。

## 复杂度分析

1. 时间复杂度：线段树的单次更改复杂度$O(\log m)$，总共$O(m\log m)$；在离散化的过程中排序复杂度$O(m\log m)$，去重复杂度$O(m)$，因此总体上初始化树时复杂度为$O(m\log m)$ 。因此整体复杂度$O(m\log m)$符合时间限制。
2. 空间复杂度：线段树需要的数组空间为$O(m)$，排序、去重的离散化过程中使用的空间复杂度为$O(m)$，因此整体空间复杂度符合空间限制。

